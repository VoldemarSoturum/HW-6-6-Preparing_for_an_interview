# Mail Client (SMTP/IMAP, CLI)

Клиент командной строки для отправки и получения писем по SMTP/IMAP.
Параметры передаются через аргументы CLI или переменные окружения. Если логин/пароль не указаны, скрипт запросит их интерактивно.

Требования: Python 3.10+ (используются аннотации вида `|`), внешние зависимости отсутствуют.

## Содержимое
- [Установка](#установка)
- [Запуск](#запуск)
- [Аргументы командной строки](#аргументы-командной-строки)
- [Переменные окружения](#переменные-окружения)
- [Примеры](#примеры)
- [Замечания по безопасности (Gmail)](#замечания-по-безопасности-gmail)
- [Типичные ошибки](#типичные-ошибки)
- [Структура проекта](#структура-проекта)
- [Лицензия](#лицензия)

## Установка

### Вариант 1: git clone (рекомендуется)

GitHub (пример):
```bash
# macOS / Linux
git clone https://github.com/<ВАШ-ЛОГИН>/<ИМЯ-РЕПОЗИТОРИЯ>.git
cd <ИМЯ-РЕПОЗИТОРИЯ>
python3 -m venv venv
source venv/bin/activate
python3 -m pip install --upgrade pip
```

```powershell
# Windows (PowerShell)
git clone https://github.com/<ВАШ-ЛОГИН>/<ИМЯ-РЕПОЗИТОРИЯ>.git
cd <ИМЯ-РЕПОЗИТОРИЯ>
py -3 -m venv venv
.env\Scripts\Activate.ps1
py -3 -m pip install --upgrade pip
```

Bitbucket аналогично, замените URL на свой.

Примечание для Windows: если активация окружения блокируется политикой выполнения, временно разрешите:
```powershell
Set-ExecutionPolicy -ExecutionPolicy RemoteSigned -Scope CurrentUser
```
Либо активируйте через CMD: `.env\Scriptsctivate.bat`.

### Вариант 2: ZIP-архив

1. Откройте страницу репозитория и нажмите **Code → Download ZIP**.  
2. Распакуйте архив.  
3. Создайте и активируйте виртуальное окружение (см. команды выше).

## Запуск

Файл с кодом назовите, например, `mail_client.py` и запускайте из корня проекта:

```bash
python mail_client.py <команда> [опции]
```

Поддерживаются две команды: `send` и `recv`.

Если `--username/--password` не переданы и нет переменных окружения, скрипт спросит логин/пароль интерактивно.

## Аргументы командной строки

Глобальные параметры:
- `-u, --username` — логин (email). Можно через `MAIL_USER`.
- `-p, --password` — пароль (рекомендуется App Password). Можно через `MAIL_PASS`.
- `--smtp` — SMTP сервер (по умолчанию `smtp.gmail.com`).
- `--smtp-port` — порт SMTP (по умолчанию `587`).
- `--imap` — IMAP сервер (по умолчанию `imap.gmail.com`).
- `--imap-port` — порт IMAP (по умолчанию `993`).
- `--no-tls` — не использовать STARTTLS для SMTP (по умолчанию TLS включен).

Команда `send` (отправка письма):
- `--to` — один или несколько получателей (обязательно).
- `--cc` — список адресов для копии (опционально).
- `--bcc` — список адресов для скрытой копии (опционально).
- `--subject` — тема письма (обязательно).
- `--body` — текст письма (обязательно, `text/plain`).

Команда `recv` (получение письма):
- `--mailbox` — папка, по умолчанию `INBOX`.
- `--subject` — фильтр по теме (используется `HEADER Subject "..."`). Необязательно.
- `--unread` — только непрочитанные письма.

Вывод при `recv`: заголовки From/Subject/Date и извлеченный `text/plain` (если есть).

## Переменные окружения

Можно передавать настройки через окружение (CLI параметр имеет приоритет):
- `MAIL_USER` — логин (email).
- `MAIL_PASS` — пароль (App Password для Gmail).
- `SMTP_SERVER`, `SMTP_PORT` — сервер/порт SMTP.
- `IMAP_SERVER`, `IMAP_PORT` — сервер/порт IMAP.

## Примеры

Отправка письма:
```bash
python mail_client.py send   --to user1@example.com user2@example.com   --cc boss@example.com   --bcc audit@example.com   --subject "Отчет"   --body "Добрый день! Отправляю отчет."
```

Получение последнего письма из INBOX:
```bash
python mail_client.py recv
```

Только непрочитанные с фильтром по теме:
```bash
python mail_client.py recv --unread --subject "Monthly Report"
```

Windows PowerShell примеры идентичны, замените `python` на `py -3` при необходимости:
```powershell
py -3 mail_client.py send --to user@example.com --subject "Test" --body "Hello"
py -3 mail_client.py recv --subject "Report"
```

## Замечания по безопасности (Gmail)

- Для Gmail рекомендуется включить 2FA и использовать **App Password** вместо обычного пароля.
- Убедитесь, что IMAP включен в настройках почтового провайдера.
- Не храните пароль в коде/репозитории; используйте переменные окружения или интерактивный ввод.

## Типичные ошибки

- `SMTPAuthenticationError` — некорректный логин/пароль или требуется App Password.
- Ошибки IMAP/подключения — проверьте хост/порт, доступ к IMAP, правильность имени папки (`INBOX` чувствителен к регистру).
- Пустое тело письма — `extract_text` извлекает `text/plain`; если письмо только `text/html`, результат может быть пустым.